<h2><%= t('labels.L_ALL_ISSUES') %></h2>

<div class="row align-items-start" id="collection-items-list">
  <% if @collection_items.present? %>
    <% @collection_items.each do |collection_item| %>
      <% if collection_item['is_issue']&.first == "Yes" %>
        <div class="card" style="width: 20rem; margin: 0 0.5rem 0.5rem 0.5rem;">
          <div class="card-body">
            <% if collection_item['subtitle_tsim'] %>
              <h5 class="card-title"><%= collection_item['subtitle_tsim'][0] %></h5>
            <% end %>
            <% if collection_item['pub_date_si'] %>
              <p class="card-text"><%= collection_item['pub_date_si'][0] %></p>
            <% end %>
            <a class="btn btn-primary" href="/catalog/<%= collection_item['id'] %>">
              <%= t('labels.L_VIEW_ISSUE') %>
            </a>
          </div>
        </div>
      <% end %>
    <% end %>
  <% else %>
    <p><%= t('labels.L_NO_ISSUES_MSG') %></p>
  <% end %>
</div>

<% max_visible = 5 %>
<% start_page = [@page - 2, 1].max %>
<% end_page = [start_page + max_visible - 1, @total_pages].min %>
<% start_page = [end_page - max_visible + 1, 1].max %>

<div class="row align-items-start">
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">

      <%# First and Previous buttons %>
      <% if @page > 1 %>
        <li class="page-item">
          <%= link_to 'First', url_for(params.to_unsafe_h.merge(page: 1)), class: 'page-link' %>
        </li>
        <li class="page-item">
          <%= link_to 'Previous', url_for(params.to_unsafe_h.merge(page: @page - 1)), class: 'page-link' %>
        </li>
      <% else %>
        <li class="page-item disabled"><span class="page-link">First</span></li>
        <li class="page-item disabled"><span class="page-link">Previous</span></li>
      <% end %>

      <%# Ellipsis before page range %>
      <% if start_page > 1 %>
        <li class="page-item disabled"><span class="page-link">…</span></li>
      <% end %>

      <%# Numbered page links %>
      <% (start_page..end_page).each do |p| %>
        <li class="page-item <%= 'active' if p == @page %>">
          <%= link_to p, url_for(params.to_unsafe_h.merge(page: p)), class: 'page-link' %>
        </li>
      <% end %>

      <%# Ellipsis after page range %>
      <% if end_page < @total_pages %>
        <li class="page-item disabled"><span class="page-link">…</span></li>
      <% end %>

      <%# Next and Last buttons %>
      <% if @page < @total_pages %>
        <li class="page-item">
          <%= link_to 'Next', url_for(params.to_unsafe_h.merge(page: @page + 1)), class: 'page-link' %>
        </li>
        <li class="page-item">
          <%= link_to 'Last', url_for(params.to_unsafe_h.merge(page: @total_pages)), class: 'page-link' %>
        </li>
      <% else %>
        <li class="page-item disabled"><span class="page-link">Next</span></li>
        <li class="page-item disabled"><span class="page-link">Last</span></li>
      <% end %>

    </ul>
  </nav>
</div>
